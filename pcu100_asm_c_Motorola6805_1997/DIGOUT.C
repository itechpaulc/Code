

//
//	#include "digout.h"
//

//////////////////////////////////////////////////
//
// Private Members
//
//////////////////////////////////////////////////




//////////////////////////////////////////////////
//
// Virtual Message Interface
//
//////////////////////////////////////////////////



//////////////////////////////////////////////////
//
// State Machine Initialization
//
//////////////////////////////////////////////////

BYTE	Construct_DOutputController(void) {

		digitalOutputState = 0x00;

	return	DOC_IDLE;
}


//////////////////////////////////////////////////
//
// Digitial Output GoActive message,
// while in IDLE
//
//////////////////////////////////////////////////

BYTE	DOC_exitA(void)
{
		StartTimer(DIGI_OUT_REFRESH_RATE);

	return DOC_ACTIVE;
}


//////////////////////////////////////////////////
//
// TimeOut message, while in ACITVE
//
//////////////////////////////////////////////////

BYTE	DOC_exitB(void)
{
		StartTimer(DIGI_OUT_REFRESH_RATE);

		LatchToOutputs();

	return SAME_STATE;
}



//////////////////////////////////////////////////
//
// Private Helper Functions	Definition
//
//////////////////////////////////////////////////

void	LatchToOutputs(void) {

	BYTE temp;

		temp = PORT_C;

		temp &= ~DIGI_OUT_MASK;

		temp |= (digitalOutputState << 1);

	PORT_C = temp;
}


//////////////////////////////////////////////////
//
// State Matrix Table
//
//////////////////////////////////////////////////

#asm
_DIGITALOUTCNTRLR:
	fdb 	xDOC_IDLE_MATRIX
	fdb		xDOC_ACTIVE_MATRIX
#endasm


//////////////////////////////////////////////////
//
// Message/Exit Function Matrix Table
//
//////////////////////////////////////////////////

#asm
xDOC_IDLE_MATRIX:
	fcb		DigiOutGoActive
	fdb		DOC_exitA
	fcb		NULL_MESSAGE
#endasm

#asm
xDOC_ACTIVE_MATRIX:
	fcb		TimeOut
	fdb		DOC_exitB
	fcb     NULL_MESSAGE
#endasm



